var be=Object.defineProperty;var ve=(o,i,u)=>i in o?be(o,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[i]=u;var S=(o,i,u)=>(ve(o,typeof i!="symbol"?i+"":i,u),u);import{_ as ce,d as le,o as O,e as P,f as $,a as re,t as Se,m as _e,S as ne,r as H,I as ae,g as Z,E as Me,R as Ae}from"./index.77bf456f.js";import{c as Be,g as Fe}from"./_commonjsHelpers.b8add541.js";import{T as xe}from"./TaskStepInstructionList.96ffeb7a.js";const De=["disabled"],Te={key:0,class:"circle animation"},ze={key:1,class:"circle animation"},Ce={key:2,class:"circle animation"},Ee={key:3,class:"circle animation"},Re={key:4,class:"circle animation"},ke={class:"circle main"},qe={class:"info"},Ie=le({__name:"ButtonSoundAnimation",props:{info:{default:"Recording..."},busy:{type:Boolean,default:!1}},setup(o){return(i,u)=>(O(),P("button",_e({class:["busy-record",o.busy?"busy":""]},i.$attrs,{disabled:o.busy}),[o.busy?(O(),P("span",Te)):$("",!0),o.busy?(O(),P("span",ze)):$("",!0),o.busy?(O(),P("span",Ce)):$("",!0),o.busy?(O(),P("span",Ee)):$("",!0),o.busy?(O(),P("span",Re)):$("",!0),re("span",ke,[re("span",qe,Se(o.info),1)])],16,De))}});var Ne=ce(Ie,[["__scopeId","data-v-c6b50d6e"]]),me={exports:{}};(function(o,i){(function(u,f){o.exports=f()})(Be,function(){function u(t,e,n){if(n||arguments.length===2)for(var r,a=0,s=e.length;a<s;a++)!r&&a in e||(r||(r=Array.prototype.slice.call(e,0,a)),r[a]=e[a]);return t.concat(r||Array.prototype.slice.call(e))}var f=Object.freeze({__proto__:null,blackman:function(t){for(var e=new Float32Array(t),n=2*Math.PI/(t-1),r=2*n,a=0;a<t/2;a++)e[a]=.42-.5*Math.cos(a*n)+.08*Math.cos(a*r);for(a=Math.ceil(t/2);a>0;a--)e[t-a]=e[a-1];return e},sine:function(t){for(var e=Math.PI/(t-1),n=new Float32Array(t),r=0;r<t;r++)n[r]=Math.sin(e*r);return n},hanning:function(t){for(var e=new Float32Array(t),n=0;n<t;n++)e[n]=.5-.5*Math.cos(2*Math.PI*n/(t-1));return e},hamming:function(t){for(var e=new Float32Array(t),n=0;n<t;n++)e[n]=.54-.46*Math.cos(2*Math.PI*(n/t-1));return e}}),g={};function y(t){for(;t%2==0&&t>1;)t/=2;return t===1}function b(t,e){if(e!=="rect"){if(e!==""&&e||(e="hanning"),g[e]||(g[e]={}),!g[e][t.length])try{g[e][t.length]=f[e](t.length)}catch{throw new Error("Invalid windowing function")}t=function(n,r){for(var a=[],s=0;s<Math.min(n.length,r.length);s++)a[s]=n[s]*r[s];return a}(t,g[e][t.length])}return t}function z(t,e,n){for(var r=new Float32Array(t),a=0;a<r.length;a++)r[a]=a*e/n,r[a]=13*Math.atan(r[a]/1315.8)+3.5*Math.atan(Math.pow(r[a]/7518,2));return r}function D(t){return Float32Array.from(t)}function _(t){return 1125*Math.log(1+t/700)}function j(t,e,n){for(var r,a=new Float32Array(t+2),s=new Float32Array(t+2),l=e/2,h=_(0),m=(_(l)-h)/(t+1),c=new Array(t+2),p=0;p<a.length;p++)a[p]=p*m,s[p]=(r=a[p],700*(Math.exp(r/1125)-1)),c[p]=Math.floor((n+1)*s[p]/e);for(var M=new Array(t),d=0;d<M.length;d++){for(M[d]=new Array(n/2+1).fill(0),p=c[d];p<c[d+1];p++)M[d][p]=(p-c[d])/(c[d+1]-c[d]);for(p=c[d+1];p<c[d+2];p++)M[d][p]=(c[d+2]-p)/(c[d+2]-c[d+1])}return M}function T(t,e,n,r,a,s,l){r===void 0&&(r=5),a===void 0&&(a=2),s===void 0&&(s=!0),l===void 0&&(l=440);var h=Math.floor(n/2)+1,m=new Array(n).fill(0).map(function(w,B){return t*function(F,I){return Math.log2(16*F/I)}(e*B/n,l)});m[0]=m[1]-1.5*t;var c,p,M,d=m.slice(1).map(function(w,B){return Math.max(w-m[B])},1).concat([1]),k=Math.round(t/2),E=new Array(t).fill(0).map(function(w,B){return m.map(function(F){return(10*t+k+F-B)%t-k})}),R=E.map(function(w,B){return w.map(function(F,I){return Math.exp(-.5*Math.pow(2*E[B][I]/d[I],2))})});if(p=(c=R)[0].map(function(){return 0}),M=c.reduce(function(w,B){return B.forEach(function(F,I){w[I]+=Math.pow(F,2)}),w},p).map(Math.sqrt),R=c.map(function(w,B){return w.map(function(F,I){return F/(M[I]||1)})}),a){var K=m.map(function(w){return Math.exp(-.5*Math.pow((w/t-r)/a,2))});R=R.map(function(w){return w.map(function(B,F){return B*K[F]})})}return s&&(R=u(u([],R.slice(3),!0),R.slice(0,3),!0)),R.map(function(w){return w.slice(0,h)})}function A(t,e){for(var n=0,r=0,a=0;a<e.length;a++)n+=Math.pow(a,t)*Math.abs(e[a]),r+=e[a];return n/r}function C(t){var e=t.ampSpectrum,n=t.barkScale,r=t.numberOfBarkBands,a=r===void 0?24:r;if(typeof e!="object"||typeof n!="object")throw new TypeError;var s=a,l=new Float32Array(s),h=0,m=e,c=new Int32Array(s+1);c[0]=0;for(var p=n[m.length-1]/s,M=1,d=0;d<m.length;d++)for(;n[d]>p;)c[M++]=d,p=M*n[m.length-1]/s;for(c[s]=m.length-1,d=0;d<s;d++){for(var k=0,E=c[d];E<c[d+1];E++)k+=m[E];l[d]=Math.pow(k,.23)}for(d=0;d<l.length;d++)h+=l[d];return{specific:l,total:h}}function L(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;for(var n=new Float32Array(e.length),r=0;r<n.length;r++)n[r]=Math.pow(e[r],2);return n}function v(t){var e=t.ampSpectrum,n=t.melFilterBank,r=t.bufferSize;if(typeof e!="object")throw new TypeError("Valid ampSpectrum is required to generate melBands");if(typeof n!="object")throw new TypeError("Valid melFilterBank is required to generate melBands");for(var a=L({ampSpectrum:e}),s=n.length,l=Array(s),h=new Float32Array(s),m=0;m<h.length;m++){l[m]=new Float32Array(r/2),h[m]=0;for(var c=0;c<r/2;c++)l[m][c]=n[m][c]*a[c],h[m]+=l[m][c];h[m]=Math.log(h[m]+1)}return Array.prototype.slice.call(h)}function q(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var J={exports:{}},U=null,he=function(t,e){var n=t.length;return e=e||2,U&&U[n]||function(r){(U=U||{})[r]=new Array(r*r);for(var a=Math.PI/r,s=0;s<r;s++)for(var l=0;l<r;l++)U[r][l+s*r]=Math.cos(a*(l+.5)*s)}(n),t.map(function(){return 0}).map(function(r,a){return e*t.reduce(function(s,l,h,m){return s+l*U[n][h+a*n]},0)})};(function(t){t.exports=he})(J);var pe=q(J.exports),ee=Object.freeze({__proto__:null,buffer:function(t){return t.signal},rms:function(t){var e=t.signal;if(typeof e!="object")throw new TypeError;for(var n=0,r=0;r<e.length;r++)n+=Math.pow(e[r],2);return n/=e.length,n=Math.sqrt(n)},energy:function(t){var e=t.signal;if(typeof e!="object")throw new TypeError;for(var n=0,r=0;r<e.length;r++)n+=Math.pow(Math.abs(e[r]),2);return n},complexSpectrum:function(t){return t.complexSpectrum},spectralSlope:function(t){var e=t.ampSpectrum,n=t.sampleRate,r=t.bufferSize;if(typeof e!="object")throw new TypeError;for(var a=0,s=0,l=new Float32Array(e.length),h=0,m=0,c=0;c<e.length;c++){a+=e[c];var p=c*n/r;l[c]=p,h+=p*p,s+=p,m+=p*e[c]}return(e.length*m-s*a)/(a*(h-Math.pow(s,2)))},spectralCentroid:function(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;return A(1,e)},spectralRolloff:function(t){var e=t.ampSpectrum,n=t.sampleRate;if(typeof e!="object")throw new TypeError;for(var r=e,a=n/(2*(r.length-1)),s=0,l=0;l<r.length;l++)s+=r[l];for(var h=.99*s,m=r.length-1;s>h&&m>=0;)s-=r[m],--m;return(m+1)*a},spectralFlatness:function(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;for(var n=0,r=0,a=0;a<e.length;a++)n+=Math.log(e[a]),r+=e[a];return Math.exp(n/e.length)*e.length/r},spectralSpread:function(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;return Math.sqrt(A(2,e)-Math.pow(A(1,e),2))},spectralSkewness:function(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;var n=A(1,e),r=A(2,e),a=A(3,e);return(2*Math.pow(n,3)-3*n*r+a)/Math.pow(Math.sqrt(r-Math.pow(n,2)),3)},spectralKurtosis:function(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;var n=e,r=A(1,n),a=A(2,n),s=A(3,n),l=A(4,n);return(-3*Math.pow(r,4)+6*r*a-4*r*s+l)/Math.pow(Math.sqrt(a-Math.pow(r,2)),4)},amplitudeSpectrum:function(t){return t.ampSpectrum},zcr:function(t){var e=t.signal;if(typeof e!="object")throw new TypeError;for(var n=0,r=1;r<e.length;r++)(e[r-1]>=0&&e[r]<0||e[r-1]<0&&e[r]>=0)&&n++;return n},loudness:C,perceptualSpread:function(t){for(var e=C({ampSpectrum:t.ampSpectrum,barkScale:t.barkScale}),n=0,r=0;r<e.specific.length;r++)e.specific[r]>n&&(n=e.specific[r]);return Math.pow((e.total-n)/e.total,2)},perceptualSharpness:function(t){for(var e=C({ampSpectrum:t.ampSpectrum,barkScale:t.barkScale}),n=e.specific,r=0,a=0;a<n.length;a++)r+=a<15?(a+1)*n[a+1]:.066*Math.exp(.171*(a+1));return r*=.11/e.total},powerSpectrum:L,mfcc:function(t){var e=t.ampSpectrum,n=t.melFilterBank,r=t.numberOfMFCCCoefficients,a=t.bufferSize,s=Math.min(40,Math.max(1,r||13));if(n.length<s)throw new Error("Insufficient filter bank for requested number of coefficients");var l=v({ampSpectrum:e,melFilterBank:n,bufferSize:a});return pe(l).slice(0,s)},chroma:function(t){var e=t.ampSpectrum,n=t.chromaFilterBank;if(typeof e!="object")throw new TypeError("Valid ampSpectrum is required to generate chroma");if(typeof n!="object")throw new TypeError("Valid chromaFilterBank is required to generate chroma");var r=n.map(function(s,l){return e.reduce(function(h,m,c){return h+m*s[c]},0)}),a=Math.max.apply(Math,r);return a?r.map(function(s){return s/a}):r},spectralFlux:function(t){var e=t.signal,n=t.previousSignal,r=t.bufferSize;if(typeof e!="object"||typeof n!="object")throw new TypeError;for(var a=0,s=-r/2;s<e.length/2-1;s++)x=Math.abs(e[s])-Math.abs(n[s]),a+=(x+Math.abs(x))/2;return a},spectralCrest:function(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;var n=0,r=-1/0;return e.forEach(function(a){n+=Math.pow(a,2),r=a>r?a:r}),n/=e.length,n=Math.sqrt(n),r/n},melBands:v});function de(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var Y={},G={},W={bitReverseArray:function(t){if(Y[t]===void 0){for(var e=(t-1).toString(2).length,n="0".repeat(e),r={},a=0;a<t;a++){var s=a.toString(2);s=n.substr(s.length)+s,s=[].concat(de(s)).reverse().join(""),r[a]=parseInt(s,2)}Y[t]=r}return Y[t]},multiply:function(t,e){return{real:t.real*e.real-t.imag*e.imag,imag:t.real*e.imag+t.imag*e.real}},add:function(t,e){return{real:t.real+e.real,imag:t.imag+e.imag}},subtract:function(t,e){return{real:t.real-e.real,imag:t.imag-e.imag}},euler:function(t,e){var n=-2*Math.PI*t/e;return{real:Math.cos(n),imag:Math.sin(n)}},conj:function(t){return t.imag*=-1,t},constructComplexArray:function(t){var e={};e.real=t.real===void 0?t.slice():t.real.slice();var n=e.real.length;return G[n]===void 0&&(G[n]=Array.apply(null,Array(n)).map(Number.prototype.valueOf,0)),e.imag=G[n].slice(),e}},ge=function(t){var e={};t.real===void 0||t.imag===void 0?e=W.constructComplexArray(t):(e.real=t.real.slice(),e.imag=t.imag.slice());var n=e.real.length,r=Math.log2(n);if(Math.round(r)!=r)throw new Error("Input size must be a power of 2.");if(e.real.length!=e.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var a=W.bitReverseArray(n),s={real:[],imag:[]},l=0;l<n;l++)s.real[a[l]]=e.real[l],s.imag[a[l]]=e.imag[l];for(var h=0;h<n;h++)e.real[h]=s.real[h],e.imag[h]=s.imag[h];for(var m=1;m<=r;m++)for(var c=Math.pow(2,m),p=0;p<c/2;p++)for(var M=W.euler(p,c),d=0;d<n/c;d++){var k=c*d+p,E=c*d+p+c/2,R={real:e.real[k],imag:e.imag[k]},K={real:e.real[E],imag:e.imag[E]},w=W.multiply(M,K),B=W.subtract(R,w);e.real[E]=B.real,e.imag[E]=B.imag;var F=W.add(w,R);e.real[k]=F.real,e.imag[k]=F.imag}return e},ye=ge,we=function(){function t(e,n){var r=this;if(this._m=n,!e.audioContext)throw this._m.errors.noAC;if(e.bufferSize&&!y(e.bufferSize))throw this._m._errors.notPow2;if(!e.source)throw this._m._errors.noSource;this._m.audioContext=e.audioContext,this._m.bufferSize=e.bufferSize||this._m.bufferSize||256,this._m.hopSize=e.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=e.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=e.callback,this._m.windowingFunction=e.windowingFunction||"hanning",this._m.featureExtractors=ee,this._m.EXTRACTION_STARTED=e.startImmediately||!1,this._m.channel=typeof e.channel=="number"?e.channel:0,this._m.inputs=e.inputs||1,this._m.outputs=e.outputs||1,this._m.numberOfMFCCCoefficients=e.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.numberOfBarkBands=e.numberOfBarkBands||this._m.numberOfBarkBands||24,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=e.featureExtractors||[],this._m.barkScale=z(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=j(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(e.source),this._m.spn.onaudioprocess=function(a){var s;r._m.inputData!==null&&(r._m.previousInputData=r._m.inputData),r._m.inputData=a.inputBuffer.getChannelData(r._m.channel),r._m.previousInputData?((s=new Float32Array(r._m.previousInputData.length+r._m.inputData.length-r._m.hopSize)).set(r._m.previousInputData.slice(r._m.hopSize)),s.set(r._m.inputData,r._m.previousInputData.length-r._m.hopSize)):s=r._m.inputData,function(l,h,m){if(l.length<h)throw new Error("Buffer is too short for frame length");if(m<1)throw new Error("Hop length cannot be less that 1");if(h<1)throw new Error("Frame length cannot be less that 1");var c=1+Math.floor((l.length-h)/m);return new Array(c).fill(0).map(function(p,M){return l.slice(M*m,M*m+h)})}(s,r._m.bufferSize,r._m.hopSize).forEach(function(l){r._m.frame=l;var h=r._m.extract(r._m._featuresToExtract,r._m.frame,r._m.previousFrame);typeof r._m.callback=="function"&&r._m.EXTRACTION_STARTED&&r._m.callback(h),r._m.previousFrame=r._m.frame})}}return t.prototype.start=function(e){this._m._featuresToExtract=e||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0},t.prototype.stop=function(){this._m.EXTRACTION_STARTED=!1},t.prototype.setSource=function(e){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=e,this._m.source.connect(this._m.spn)},t.prototype.setChannel=function(e){e<=this._m.inputs?this._m.channel=e:console.error("Channel ".concat(e," does not exist. Make sure you've provided a value for 'inputs' that is greater than ").concat(e," when instantiating the MeydaAnalyzer"))},t.prototype.get=function(e){return this._m.inputData?this._m.extract(e||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null},t}(),Q={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:ee,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,numberOfBarkBands:24,_featuresToExtract:[],windowing:b,_errors:{notPow2:new Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:new Error("Meyda: No features defined."),invalidFeatureFmt:new Error("Meyda: Invalid feature format"),invalidInput:new Error("Meyda: Invalid input."),noAC:new Error("Meyda: No AudioContext specified."),noSource:new Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(t){return new we(t,Object.assign({},Q))},listAvailableFeatureExtractors:function(){return Object.keys(this.featureExtractors)},extract:function(t,e,n){var r=this;if(!e)throw this._errors.invalidInput;if(typeof e!="object")throw this._errors.invalidInput;if(!t)throw this._errors.featureUndef;if(!y(e.length))throw this._errors.notPow2;this.barkScale!==void 0&&this.barkScale.length==this.bufferSize||(this.barkScale=z(this.bufferSize,this.sampleRate,this.bufferSize)),this.melFilterBank!==void 0&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=j(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),this.chromaFilterBank!==void 0&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=T(this.chromaBands,this.sampleRate,this.bufferSize)),"buffer"in e&&e.buffer===void 0?this.signal=D(e):this.signal=e;var a=te(e,this.windowingFunction,this.bufferSize);if(this.signal=a.windowedSignal,this.complexSpectrum=a.complexSpectrum,this.ampSpectrum=a.ampSpectrum,n){var s=te(n,this.windowingFunction,this.bufferSize);this.previousSignal=s.windowedSignal,this.previousComplexSpectrum=s.complexSpectrum,this.previousAmpSpectrum=s.ampSpectrum}var l=function(h){return r.featureExtractors[h]({ampSpectrum:r.ampSpectrum,chromaFilterBank:r.chromaFilterBank,complexSpectrum:r.complexSpectrum,signal:r.signal,bufferSize:r.bufferSize,sampleRate:r.sampleRate,barkScale:r.barkScale,melFilterBank:r.melFilterBank,previousSignal:r.previousSignal,previousAmpSpectrum:r.previousAmpSpectrum,previousComplexSpectrum:r.previousComplexSpectrum,numberOfMFCCCoefficients:r.numberOfMFCCCoefficients,numberOfBarkBands:r.numberOfBarkBands})};if(typeof t=="object")return t.reduce(function(h,m){var c;return Object.assign({},h,((c={})[m]=l(m),c))},{});if(typeof t=="string")return l(t);throw this._errors.invalidFeatureFmt}},te=function(t,e,n){var r={};t.buffer===void 0?r.signal=D(t):r.signal=t,r.windowedSignal=b(r.signal,e),r.complexSpectrum=ye(r.windowedSignal),r.ampSpectrum=new Float32Array(n/2);for(var a=0;a<n/2;a++)r.ampSpectrum[a]=Math.sqrt(Math.pow(r.complexSpectrum.real[a],2)+Math.pow(r.complexSpectrum.imag[a],2));return r};return typeof window!="undefined"&&(window.Meyda=Q),Q})})(me);var ie=Fe(me.exports);const Oe=20,Pe=2e4,fe={_frequencyResolution(o,i){return Number((o/i).toFixed(4))},_frequency(o,i){return Number((o*i).toFixed(4))},_frequenciesUsingFrequencyResolution(o,i){const u=[];for(let f=0;f<i/2;f++)u.push(this._frequency(f,o));return u},frequenciesUsingSampleRateBufferSize(o,i){const u=this._frequencyResolution(o,i);return this._frequenciesUsingFrequencyResolution(u,i)},lowestAudibleBin(o,i=Oe){const u=i/o,f=Math.floor(u);return f!==u?f+1:f},highestAudibleBin(o,i=Pe){return Math.trunc(i/o)},audibleBins(o,i,u){return o.slice(i,u)},removeInaudibleBinsFromSpectrumList(o,i,u){const f=this._frequencyResolution(i,u),g=this.lowestAudibleBin(f),y=this.highestAudibleBin(f);return o.map(b=>this.audibleBins(b,g,y))}};class X{constructor(i=5,u=44100,f=8192,g=1,y="hanning",b=20,z=2e4,D=fe.frequenciesUsingSampleRateBufferSize(u,f)){S(this,"durationSeconds");S(this,"bufferSize");S(this,"sampleRate");S(this,"numberOfInputChannels");S(this,"windowingFunction");S(this,"frequencies");S(this,"lowestPerceptibleFrequency");S(this,"highestPerceptibleFrequency");this.durationSeconds=i,this.sampleRate=u,this.bufferSize=f,this.numberOfInputChannels=g,this.windowingFunction=y,this.lowestPerceptibleFrequency=b,this.highestPerceptibleFrequency=z,this.frequencies=D}clone(){return new X(this.durationSeconds,this.sampleRate,this.bufferSize,this.numberOfInputChannels,this.windowingFunction,this.lowestPerceptibleFrequency,this.highestPerceptibleFrequency,this.frequencies)}}class oe{constructor(i=new X){S(this,"config");S(this,"startTimestamp",Date.now());S(this,"stopTimestamp",Date.now());S(this,"timestamps",[]);S(this,"amplitudeSpectrumList",[]);this.config=i}addData(i){i.length===0&&(this.startTimestamp=Date.now()),this.stopTimestamp=Date.now(),this.timestamps.push(this.stopTimestamp-this.startTimestamp),this.amplitudeSpectrumList.push(i)}clear(){this.startTimestamp=Date.now(),this.stopTimestamp=Date.now(),this.amplitudeSpectrumList=[]}getAmplitudeSpectrumList(){return this.amplitudeSpectrumList.map(i=>Array.from(i))}toString(){return`AnalyzeData:
Duration: ${((this.stopTimestamp-this.startTimestamp)/1e3).toFixed(0)}	Entries: ${this.timestamps.length}`}}class je{constructor(i){S(this,"analyzer");S(this,"mic");S(this,"analysisConfig");S(this,"store",new oe);this.mic=i,this.analysisConfig=new X(void 0,i.sampleRate,i.bufferSize)}async startAnalyzer(i){if(console.info("[AudioDBAnalyzer]: Try to start analyzer"),typeof ie=="undefined"){console.error("[AudioDBAnalyzer]: Meyda could not be found! Have you included it?");return}try{this.store=new oe(this.analysisConfig),await this.mic.activateInputDevice(i==null?void 0:i.deviceId),console.log("MIC",this.mic),console.info(`[AudioDBAnalyzer]: Sample Rate ${this.mic.sampleRate}`),console.info(`[AudioDBAnalyzer]: Buffer Size ${this.mic.bufferSize}`),console.info(`[AudioDBAnalyzer]: Windowing Function ${this.analysisConfig.windowingFunction}`),this.analyzer=ie.createMeydaAnalyzer({audioContext:this.mic.audioContext,source:this.mic.sourceAudioNode,sampleRate:this.mic.sampleRate,bufferSize:this.mic.bufferSize,windowingFunction:this.analysisConfig.windowingFunction,featureExtractors:["amplitudeSpectrum"],callback:u=>{this.store.addData(u.amplitudeSpectrum)}}),this.analyzer.start(),console.info("[AudioDBAnalyzer]: Analyzer started")}catch(u){throw console.error("[AudioDBAnalyzer]: Analyzer start failed",u),new ne("Aufnahme konnte nicht gestartet werden. Bitte versuchen Sie es erneut.",u)}}async stopAnalyzer(){if(console.info("[AudioDBAnalyzer]: Try to stop analyzer"),!this.analyzer){console.warn("[AudioDBAnalyzer]: No analyzer to stop found");return}try{this.analyzer.stop(),await this.mic.deactivateInputDevices(),console.info("[AudioDBAnalyzer]: ANALYZER STOP")}catch(i){throw console.error("[AudioDBAnalyzer]: Analyzer stop failed",i),new ne("Aufnahme konnte nicht gestoppt werden. Bitte versuchen Sie es erneut.",i)}}async analyze(i=0,u=void 0){await this.startAnalyzer(u);const f=i||this.analysisConfig.durationSeconds;return this.analysisConfig.durationSeconds=f,await new Promise(y=>{setTimeout(async()=>{await this.stopAnalyzer(),y()},f*1e3)}),this.store}}const se={_calcAWeighting(o){const i=Math.pow(o,2),u=148693636,f=423.9481,g=11577.76,y=544348.84,b=u*Math.pow(i,2),z=+(i+u).toFixed(8)*+(i+f).toFixed(8)*+Math.sqrt(i+g).toFixed(8)*+Math.sqrt(i+y).toFixed(8),D=+(b/z).toFixed(8),_=20*Math.log10(D)+2;return Number(_.toFixed(1))},calcAWeightings(o,i=-80){return o.map(u=>{const f=this._calcAWeighting(u);return f>i?f:i})},calcDBAUsingWeighting(o,i){const u=o+i;return Number(u.toFixed(4))},convertDBSpectrumToDBAsSpectrum(o,i){const u=[];for(const[f,g]of o.entries())u.push(this.calcDBAUsingWeighting(g,i[f]));return u}},ue=2e-5,N={magnitudeToDB(o){if(o<2e-9)return-80;const i=Number((20*Math.log10(o/ue)).toFixed(4));return i===0?0:i},dbToPowerRatio(o){return Number(Math.pow(10,o/10).toFixed(4))},powerRatioToDB(o){return o<1e-4?-80:Number((10*Math.log10(o)).toFixed(4))},dbToMagnitude(o){return o<-45?2e-9:Number(Math.sqrt(this.dbToPowerRatio(o)*Math.pow(ue,2)).toFixed(9))},_getMeasurementDurationInMs(o,i){return Number((i/o*1e3).toFixed(0))},removeFirstMeasurementsByDuration(o,i,u,f=1500){const g=this._getMeasurementDurationInMs(i,u),y=Number((f/g).toFixed(0));return o.slice(y)}},V={_calcRMS(o){const i=o.reduce((u,f)=>u+Math.pow(f,2),0);return Math.sqrt(i/o.length)},magnitudeSpectrumToDBSpectrum(o){return o.map(i=>N.magnitudeToDB(i))},dbSpectrumToDB(o){const i=o.map(f=>N.dbToMagnitude(f)),u=this._calcRMS(i);return N.magnitudeToDB(u)},averageSPL(o){const i=o.reduce((f,g)=>f+N.dbToPowerRatio(g),0),u=o.length;return N.powerRatioToDB(i/u)},totalSPL(o){const i=o.reduce((u,f)=>u+N.dbToPowerRatio(f),0);return N.powerRatioToDB(i)}},Le={_calcDBList(o){return o.map(i=>V.dbSpectrumToDB(i))},_calcDBAList(o,i,u){const f=fe.frequenciesUsingSampleRateBufferSize(i,u),g=se.calcAWeightings(f);return o.map(b=>se.convertDBSpectrumToDBAsSpectrum(b,g)).map(b=>V.dbSpectrumToDB(b))},getResult(o,i,u){console.log(o);const g=N.removeFirstMeasurementsByDuration(o,i,u).map(C=>V.magnitudeSpectrumToDBSpectrum(C));console.log(g);const y=this._calcDBList(g).filter(C=>C>=0),b=Number(V.averageSPL(y).toFixed(2)),z=Number(Math.min(...y).toFixed(2)),D=Number(Math.max(...y).toFixed(2)),_=this._calcDBAList(g,i,u).filter(C=>C>=0),j=Number(V.averageSPL(_).toFixed(2)),T=Number(Math.min(..._).toFixed(2)),A=Number(Math.max(..._).toFixed(2));return{dbas:_,minDBA:T,maxDBA:A,averageDBA:j,dbs:y,minDB:z,maxDB:D,averageDB:b}}};const Ue={class:"noise-measurement-activity"},We=le({__name:"ActivityNoiseMeasurement",props:{taskStep:null,sensors:null},emits:["submit"],setup(o,{emit:i}){const u=o,f=H(!1),g=H(!1),y="L\xE4rmaufnahme starten",b=H(y),z=u.sensors.get(ae.GEOLOCATION),D=H();z.getPermission();const _=u.sensors.get(ae.MIC);_.getPermission();const j=async()=>{f.value=!0,g.value=!1,D.value=void 0,b.value="L\xE4rm wird aufgenommen...";try{const T=new je(_);console.info("micAnalyzer created");const A=10,C=await T.analyze(A);console.info("analysisData retrieved");const L=await z.getLocation();console.info("location retrieved");const v=new Ae;v.addMeta("sampleRate",_.sampleRate),v.addMeta("bufferSize",_.bufferSize),v.addMeta("windowingFunction",T.analysisConfig.windowingFunction),v.addMeta("lowestPerceptibleFrequency",T.analysisConfig.lowestPerceptibleFrequency),v.addMeta("highestPerceptibleFrequency",T.analysisConfig.highestPerceptibleFrequency),console.info("write metadata"),v.addMeasurement("latitude",L.coords.latitude),v.addMeasurement("longitude",L.coords.longitude),v.addMeasurement("accuracy",Number(L.coords.accuracy.toFixed(2)));const q=Le.getResult(C.getAmplitudeSpectrumList(),_.sampleRate,_.bufferSize);console.info("write results",q),v.addMeasurement("minDBA",q.minDBA),v.addMeasurement("maxDBA",q.maxDBA),v.addMeasurement("averageDBA",q.averageDBA),v.addMeasurement("minDB",q.minDB),v.addMeasurement("maxDB",q.maxDB),v.addMeasurement("averageDB",q.averageDB),console.info("write log"),g.value=!0,i("submit",[v])}catch(T){console.error(T),D.value=T,g.value=!1}finally{f.value=!1,b.value=y}};return(T,A)=>(O(),P("div",Ue,[Z(xe,{title:o.taskStep.title,description:o.taskStep.description,instructions:o.taskStep.instructions},null,8,["title","description","instructions"]),Z(Me,{error:D.value},null,8,["error"]),Z(Ne,{busy:f.value,success:g.value,info:b.value,onClick:j},null,8,["busy","success","info"])]))}});var Ye=ce(We,[["__scopeId","data-v-0e64674e"]]);export{Ye as default};
