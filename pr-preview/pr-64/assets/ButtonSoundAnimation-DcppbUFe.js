var he=Object.defineProperty;var fe=(s,i,u)=>i in s?he(s,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[i]=u;var S=(s,i,u)=>fe(s,typeof i!="symbol"?i+"":i,u);import{x as pe,y as de,S as Z,d as ge,o as O,e as N,g as j,a as J,t as we,z as ye,_ as Se}from"./index-Cs5H5E-P.js";var ae={exports:{}};(function(s,i){(function(u,h){s.exports=h()})(pe,function(){function u(t,e,n){for(var r,a=0,o=e.length;a<o;a++)!r&&a in e||(r||(r=Array.prototype.slice.call(e,0,a)),r[a]=e[a]);return t.concat(r||Array.prototype.slice.call(e))}var h=Object.freeze({__proto__:null,blackman:function(t){for(var e=new Float32Array(t),n=2*Math.PI/(t-1),r=2*n,a=0;a<t/2;a++)e[a]=.42-.5*Math.cos(a*n)+.08*Math.cos(a*r);for(a=Math.ceil(t/2);a>0;a--)e[t-a]=e[a-1];return e},hamming:function(t){for(var e=new Float32Array(t),n=0;n<t;n++)e[n]=.54-.46*Math.cos(2*Math.PI*(n/t-1));return e},hanning:function(t){for(var e=new Float32Array(t),n=0;n<t;n++)e[n]=.5-.5*Math.cos(2*Math.PI*n/(t-1));return e},sine:function(t){for(var e=Math.PI/(t-1),n=new Float32Array(t),r=0;r<t;r++)n[r]=Math.sin(e*r);return n}}),g={};function y(t){for(;t%2==0&&t>1;)t/=2;return t===1}function v(t,e){if(e!=="rect"){if(e!==""&&e||(e="hanning"),g[e]||(g[e]={}),!g[e][t.length])try{g[e][t.length]=h[e](t.length)}catch{throw new Error("Invalid windowing function")}t=function(n,r){for(var a=[],o=0;o<Math.min(n.length,r.length);o++)a[o]=n[o]*r[o];return a}(t,g[e][t.length])}return t}function C(t,e,n){for(var r=new Float32Array(t),a=0;a<r.length;a++)r[a]=a*e/n,r[a]=13*Math.atan(r[a]/1315.8)+3.5*Math.atan(Math.pow(r[a]/7518,2));return r}function E(t){return Float32Array.from(t)}function z(t){return 1125*Math.log(1+t/700)}function L(t,e,n){for(var r,a=new Float32Array(t+2),o=new Float32Array(t+2),m=e/2,p=z(0),l=(z(m)-p)/(t+1),c=new Array(t+2),d=0;d<a.length;d++)a[d]=d*l,o[d]=(r=a[d],700*(Math.exp(r/1125)-1)),c[d]=Math.floor((n+1)*o[d]/e);for(var _=new Array(t),f=0;f<_.length;f++){for(_[f]=new Array(n/2+1).fill(0),d=c[f];d<c[f+1];d++)_[f][d]=(d-c[f])/(c[f+1]-c[f]);for(d=c[f+1];d<c[f+2];d++)_[f][d]=(c[f+2]-d)/(c[f+2]-c[f+1])}return _}function W(t,e,n,r,a,o,m){r===void 0&&(r=5),a===void 0&&(a=2),o===void 0&&(o=!0),m===void 0&&(m=440);var p=Math.floor(n/2)+1,l=new Array(n).fill(0).map(function(w,b){return t*function(A,R){return Math.log2(16*A/R)}(e*b/n,m)});l[0]=l[1]-1.5*t;var c,d,_,f=l.slice(1).map(function(w,b){return Math.max(w-l[b])},1).concat([1]),D=Math.round(t/2),B=new Array(t).fill(0).map(function(w,b){return l.map(function(A){return(10*t+D+A-b)%t-D})}),F=B.map(function(w,b){return w.map(function(A,R){return Math.exp(-.5*Math.pow(2*B[b][R]/f[R],2))})});if(d=(c=F)[0].map(function(){return 0}),_=c.reduce(function(w,b){return b.forEach(function(A,R){w[R]+=Math.pow(A,2)}),w},d).map(Math.sqrt),F=c.map(function(w,b){return w.map(function(A,R){return A/(_[R]||1)})}),a){var X=l.map(function(w){return Math.exp(-.5*Math.pow((w/t-r)/a,2))});F=F.map(function(w){return w.map(function(b,A){return b*X[A]})})}return o&&(F=u(u([],F.slice(3),!0),F.slice(0,3))),F.map(function(w){return w.slice(0,p)})}function M(t,e){for(var n=0,r=0,a=0;a<e.length;a++)n+=Math.pow(a,t)*Math.abs(e[a]),r+=e[a];return n/r}function T(t){var e=t.ampSpectrum,n=t.barkScale,r=t.numberOfBarkBands,a=r===void 0?24:r;if(typeof e!="object"||typeof n!="object")throw new TypeError;var o=a,m=new Float32Array(o),p=0,l=e,c=new Int32Array(o+1);c[0]=0;for(var d=n[l.length-1]/o,_=1,f=0;f<l.length;f++)for(;n[f]>d;)c[_++]=f,d=_*n[l.length-1]/o;for(c[o]=l.length-1,f=0;f<o;f++){for(var D=0,B=c[f];B<c[f+1];B++)D+=l[B];m[f]=Math.pow(D,.23)}for(f=0;f<m.length;f++)p+=m[f];return{specific:m,total:p}}function Y(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;for(var n=new Float32Array(e.length),r=0;r<n.length;r++)n[r]=Math.pow(e[r],2);return n}function G(t){var e=t.ampSpectrum,n=t.melFilterBank,r=t.bufferSize;if(typeof e!="object")throw new TypeError("Valid ampSpectrum is required to generate melBands");if(typeof n!="object")throw new TypeError("Valid melFilterBank is required to generate melBands");for(var a=Y({ampSpectrum:e}),o=n.length,m=Array(o),p=new Float32Array(o),l=0;l<p.length;l++){m[l]=new Float32Array(r/2),p[l]=0;for(var c=0;c<r/2;c++)m[l][c]=n[l][c]*a[c],p[l]+=m[l][c];p[l]=Math.log(p[l]+1)}return Array.prototype.slice.call(p)}function oe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var q=null,se=oe(function(t,e){var n=t.length;return e=e||2,q&&q[n]||function(r){(q=q||{})[r]=new Array(r*r);for(var a=Math.PI/r,o=0;o<r;o++)for(var m=0;m<r;m++)q[r][m+o*r]=Math.cos(a*(m+.5)*o)}(n),t.map(function(){return 0}).map(function(r,a){return e*t.reduce(function(o,m,p,l){return o+m*q[n][p+a*n]},0)})}),Q=Object.freeze({__proto__:null,amplitudeSpectrum:function(t){return t.ampSpectrum},buffer:function(t){return t.signal},chroma:function(t){var e=t.ampSpectrum,n=t.chromaFilterBank;if(typeof e!="object")throw new TypeError("Valid ampSpectrum is required to generate chroma");if(typeof n!="object")throw new TypeError("Valid chromaFilterBank is required to generate chroma");var r=n.map(function(o,m){return e.reduce(function(p,l,c){return p+l*o[c]},0)}),a=Math.max.apply(Math,r);return a?r.map(function(o){return o/a}):r},complexSpectrum:function(t){return t.complexSpectrum},energy:function(t){var e=t.signal;if(typeof e!="object")throw new TypeError;for(var n=0,r=0;r<e.length;r++)n+=Math.pow(Math.abs(e[r]),2);return n},loudness:T,melBands:G,mfcc:function(t){var e=t.ampSpectrum,n=t.melFilterBank,r=t.numberOfMFCCCoefficients,a=t.bufferSize,o=Math.min(40,Math.max(1,r||13));if(n.length<o)throw new Error("Insufficient filter bank for requested number of coefficients");var m=G({ampSpectrum:e,melFilterBank:n,bufferSize:a});return se(m).slice(0,o)},perceptualSharpness:function(t){for(var e=T({ampSpectrum:t.ampSpectrum,barkScale:t.barkScale}),n=e.specific,r=0,a=0;a<n.length;a++)r+=a<15?(a+1)*n[a+1]:.066*Math.exp(.171*(a+1));return r*=.11/e.total},perceptualSpread:function(t){for(var e=T({ampSpectrum:t.ampSpectrum,barkScale:t.barkScale}),n=0,r=0;r<e.specific.length;r++)e.specific[r]>n&&(n=e.specific[r]);return Math.pow((e.total-n)/e.total,2)},powerSpectrum:Y,rms:function(t){var e=t.signal;if(typeof e!="object")throw new TypeError;for(var n=0,r=0;r<e.length;r++)n+=Math.pow(e[r],2);return n/=e.length,n=Math.sqrt(n)},spectralCentroid:function(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;return M(1,e)},spectralCrest:function(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;var n=0,r=-1/0;return e.forEach(function(a){n+=Math.pow(a,2),r=a>r?a:r}),n/=e.length,n=Math.sqrt(n),r/n},spectralFlatness:function(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;for(var n=0,r=0,a=0;a<e.length;a++)n+=Math.log(e[a]),r+=e[a];return Math.exp(n/e.length)*e.length/r},spectralFlux:function(t){var e=t.signal,n=t.previousSignal,r=t.bufferSize;if(typeof e!="object"||typeof n!="object")throw new TypeError;for(var a=0,o=-r/2;o<e.length/2-1;o++)x=Math.abs(e[o])-Math.abs(n[o]),a+=(x+Math.abs(x))/2;return a},spectralKurtosis:function(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;var n=e,r=M(1,n),a=M(2,n),o=M(3,n),m=M(4,n);return(-3*Math.pow(r,4)+6*r*a-4*r*o+m)/Math.pow(Math.sqrt(a-Math.pow(r,2)),4)},spectralRolloff:function(t){var e=t.ampSpectrum,n=t.sampleRate;if(typeof e!="object")throw new TypeError;for(var r=e,a=n/(2*(r.length-1)),o=0,m=0;m<r.length;m++)o+=r[m];for(var p=.99*o,l=r.length-1;o>p&&l>=0;)o-=r[l],--l;return(l+1)*a},spectralSkewness:function(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;var n=M(1,e),r=M(2,e),a=M(3,e);return(2*Math.pow(n,3)-3*n*r+a)/Math.pow(Math.sqrt(r-Math.pow(n,2)),3)},spectralSlope:function(t){var e=t.ampSpectrum,n=t.sampleRate,r=t.bufferSize;if(typeof e!="object")throw new TypeError;for(var a=0,o=0,m=new Float32Array(e.length),p=0,l=0,c=0;c<e.length;c++){a+=e[c];var d=c*n/r;m[c]=d,p+=d*d,o+=d,l+=d*e[c]}return(e.length*l-o*a)/(a*(p-Math.pow(o,2)))},spectralSpread:function(t){var e=t.ampSpectrum;if(typeof e!="object")throw new TypeError;return Math.sqrt(M(2,e)-Math.pow(M(1,e),2))},zcr:function(t){var e=t.signal;if(typeof e!="object")throw new TypeError;for(var n=0,r=1;r<e.length;r++)(e[r-1]>=0&&e[r]<0||e[r-1]<0&&e[r]>=0)&&n++;return n}});function ue(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var H={},V={},I={bitReverseArray:function(t){if(H[t]===void 0){for(var e=(t-1).toString(2).length,n="0".repeat(e),r={},a=0;a<t;a++){var o=a.toString(2);o=n.substr(o.length)+o,o=[].concat(ue(o)).reverse().join(""),r[a]=parseInt(o,2)}H[t]=r}return H[t]},multiply:function(t,e){return{real:t.real*e.real-t.imag*e.imag,imag:t.real*e.imag+t.imag*e.real}},add:function(t,e){return{real:t.real+e.real,imag:t.imag+e.imag}},subtract:function(t,e){return{real:t.real-e.real,imag:t.imag-e.imag}},euler:function(t,e){var n=-2*Math.PI*t/e;return{real:Math.cos(n),imag:Math.sin(n)}},conj:function(t){return t.imag*=-1,t},constructComplexArray:function(t){var e={};e.real=t.real===void 0?t.slice():t.real.slice();var n=e.real.length;return V[n]===void 0&&(V[n]=Array.apply(null,Array(n)).map(Number.prototype.valueOf,0)),e.imag=V[n].slice(),e}},ce=function(t){var e={};t.real===void 0||t.imag===void 0?e=I.constructComplexArray(t):(e.real=t.real.slice(),e.imag=t.imag.slice());var n=e.real.length,r=Math.log2(n);if(Math.round(r)!=r)throw new Error("Input size must be a power of 2.");if(e.real.length!=e.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var a=I.bitReverseArray(n),o={real:[],imag:[]},m=0;m<n;m++)o.real[a[m]]=e.real[m],o.imag[a[m]]=e.imag[m];for(var p=0;p<n;p++)e.real[p]=o.real[p],e.imag[p]=o.imag[p];for(var l=1;l<=r;l++)for(var c=Math.pow(2,l),d=0;d<c/2;d++)for(var _=I.euler(d,c),f=0;f<n/c;f++){var D=c*f+d,B=c*f+d+c/2,F={real:e.real[D],imag:e.imag[D]},X={real:e.real[B],imag:e.imag[B]},w=I.multiply(_,X),b=I.subtract(F,w);e.real[B]=b.real,e.imag[B]=b.imag;var A=I.add(w,F);e.real[D]=A.real,e.imag[D]=A.imag}return e},le=ce,me=function(){function t(e,n){var r=this;if(this._m=n,!e.audioContext)throw this._m.errors.noAC;if(e.bufferSize&&!y(e.bufferSize))throw this._m._errors.notPow2;if(!e.source)throw this._m._errors.noSource;this._m.audioContext=e.audioContext,this._m.bufferSize=e.bufferSize||this._m.bufferSize||256,this._m.hopSize=e.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=e.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=e.callback,this._m.windowingFunction=e.windowingFunction||"hanning",this._m.featureExtractors=Q,this._m.EXTRACTION_STARTED=e.startImmediately||!1,this._m.channel=typeof e.channel=="number"?e.channel:0,this._m.inputs=e.inputs||1,this._m.outputs=e.outputs||1,this._m.numberOfMFCCCoefficients=e.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.numberOfBarkBands=e.numberOfBarkBands||this._m.numberOfBarkBands||24,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=e.featureExtractors||[],this._m.barkScale=C(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=L(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(e.source),this._m.spn.onaudioprocess=function(a){var o;r._m.inputData!==null&&(r._m.previousInputData=r._m.inputData),r._m.inputData=a.inputBuffer.getChannelData(r._m.channel),r._m.previousInputData?((o=new Float32Array(r._m.previousInputData.length+r._m.inputData.length-r._m.hopSize)).set(r._m.previousInputData.slice(r._m.hopSize)),o.set(r._m.inputData,r._m.previousInputData.length-r._m.hopSize)):o=r._m.inputData;var m=function(p,l,c){if(p.length<l)throw new Error("Buffer is too short for frame length");if(c<1)throw new Error("Hop length cannot be less that 1");if(l<1)throw new Error("Frame length cannot be less that 1");var d=1+Math.floor((p.length-l)/c);return new Array(d).fill(0).map(function(_,f){return p.slice(f*c,f*c+l)})}(o,r._m.bufferSize,r._m.hopSize);m.forEach(function(p){r._m.frame=p;var l=r._m.extract(r._m._featuresToExtract,r._m.frame,r._m.previousFrame);typeof r._m.callback=="function"&&r._m.EXTRACTION_STARTED&&r._m.callback(l),r._m.previousFrame=r._m.frame})}}return t.prototype.start=function(e){this._m._featuresToExtract=e||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0},t.prototype.stop=function(){this._m.EXTRACTION_STARTED=!1},t.prototype.setSource=function(e){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=e,this._m.source.connect(this._m.spn)},t.prototype.setChannel=function(e){e<=this._m.inputs?this._m.channel=e:console.error("Channel ".concat(e," does not exist. Make sure you've provided a value for 'inputs' that is greater than ").concat(e," when instantiating the MeydaAnalyzer"))},t.prototype.get=function(e){return this._m.inputData?this._m.extract(e||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null},t}(),$={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:Q,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,numberOfBarkBands:24,_featuresToExtract:[],windowing:v,_errors:{notPow2:new Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:new Error("Meyda: No features defined."),invalidFeatureFmt:new Error("Meyda: Invalid feature format"),invalidInput:new Error("Meyda: Invalid input."),noAC:new Error("Meyda: No AudioContext specified."),noSource:new Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(t){return new me(t,Object.assign({},$))},listAvailableFeatureExtractors:function(){return Object.keys(this.featureExtractors)},extract:function(t,e,n){var r=this;if(!e)throw this._errors.invalidInput;if(typeof e!="object")throw this._errors.invalidInput;if(!t)throw this._errors.featureUndef;if(!y(e.length))throw this._errors.notPow2;this.barkScale!==void 0&&this.barkScale.length==this.bufferSize||(this.barkScale=C(this.bufferSize,this.sampleRate,this.bufferSize)),this.melFilterBank!==void 0&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=L(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),this.chromaFilterBank!==void 0&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=W(this.chromaBands,this.sampleRate,this.bufferSize)),"buffer"in e&&e.buffer===void 0?this.signal=E(e):this.signal=e;var a=K(e,this.windowingFunction,this.bufferSize);if(this.signal=a.windowedSignal,this.complexSpectrum=a.complexSpectrum,this.ampSpectrum=a.ampSpectrum,n){var o=K(n,this.windowingFunction,this.bufferSize);this.previousSignal=o.windowedSignal,this.previousComplexSpectrum=o.complexSpectrum,this.previousAmpSpectrum=o.ampSpectrum}var m=function(p){return r.featureExtractors[p]({ampSpectrum:r.ampSpectrum,chromaFilterBank:r.chromaFilterBank,complexSpectrum:r.complexSpectrum,signal:r.signal,bufferSize:r.bufferSize,sampleRate:r.sampleRate,barkScale:r.barkScale,melFilterBank:r.melFilterBank,previousSignal:r.previousSignal,previousAmpSpectrum:r.previousAmpSpectrum,previousComplexSpectrum:r.previousComplexSpectrum,numberOfMFCCCoefficients:r.numberOfMFCCCoefficients,numberOfBarkBands:r.numberOfBarkBands})};if(typeof t=="object")return t.reduce(function(p,l){var c;return Object.assign({},p,((c={})[l]=m(l),c))},{});if(typeof t=="string")return m(t);throw this._errors.invalidFeatureFmt}},K=function(t,e,n){var r={};t.buffer===void 0?r.signal=E(t):r.signal=t,r.windowedSignal=v(r.signal,e),r.complexSpectrum=le(r.windowedSignal),r.ampSpectrum=new Float32Array(n/2);for(var a=0;a<n/2;a++)r.ampSpectrum[a]=Math.sqrt(Math.pow(r.complexSpectrum.real[a],2)+Math.pow(r.complexSpectrum.imag[a],2));return r};return typeof window<"u"&&(window.Meyda=$),$})})(ae);var be=ae.exports;const ee=de(be),ve=20,_e=2e4,ie={_frequencyResolution(s,i){return Number((s/i).toFixed(4))},_frequency(s,i){return Number((s*i).toFixed(4))},_frequenciesUsingFrequencyResolution(s,i){const u=[];for(let h=0;h<i/2;h++)u.push(this._frequency(h,s));return u},frequenciesUsingSampleRateBufferSize(s,i){const u=this._frequencyResolution(s,i);return this._frequenciesUsingFrequencyResolution(u,i)},lowestAudibleBin(s,i=ve){const u=i/s,h=Math.floor(u);return h!==u?h+1:h},highestAudibleBin(s,i=_e){return Math.trunc(i/s)},audibleBins(s,i,u){return s.slice(i,u)},removeInaudibleBinsFromSpectrumList(s,i,u){const h=this._frequencyResolution(i,u),g=this.lowestAudibleBin(h),y=this.highestAudibleBin(h);return s.map(v=>this.audibleBins(v,g,y))}};class U{constructor(i=5,u=44100,h=8192,g=1,y="hanning",v=20,C=2e4,E=ie.frequenciesUsingSampleRateBufferSize(u,h)){S(this,"durationSeconds");S(this,"bufferSize");S(this,"sampleRate");S(this,"numberOfInputChannels");S(this,"windowingFunction");S(this,"frequencies");S(this,"lowestPerceptibleFrequency");S(this,"highestPerceptibleFrequency");this.durationSeconds=i,this.sampleRate=u,this.bufferSize=h,this.numberOfInputChannels=g,this.windowingFunction=y,this.lowestPerceptibleFrequency=v,this.highestPerceptibleFrequency=C,this.frequencies=E}clone(){return new U(this.durationSeconds,this.sampleRate,this.bufferSize,this.numberOfInputChannels,this.windowingFunction,this.lowestPerceptibleFrequency,this.highestPerceptibleFrequency,this.frequencies)}}class te{constructor(i=new U){S(this,"config");S(this,"startTimestamp",Date.now());S(this,"stopTimestamp",Date.now());S(this,"timestamps",[]);S(this,"amplitudeSpectrumList",[]);this.config=i}addData(i){i.length===0&&(this.startTimestamp=Date.now()),this.stopTimestamp=Date.now(),this.timestamps.push(this.stopTimestamp-this.startTimestamp),this.amplitudeSpectrumList.push(i)}clear(){this.startTimestamp=Date.now(),this.stopTimestamp=Date.now(),this.amplitudeSpectrumList=[]}getAmplitudeSpectrumList(){return this.amplitudeSpectrumList.map(i=>Array.from(i))}toString(){return`AnalyzeData:
Duration: ${((this.stopTimestamp-this.startTimestamp)/1e3).toFixed(0)}	Entries: ${this.timestamps.length}`}}class ke{constructor(i){S(this,"analyzer");S(this,"mic");S(this,"analysisConfig");S(this,"store",new te);this.mic=i,this.analysisConfig=new U(void 0,i.sampleRate,i.bufferSize)}async startAnalyzer(i){if(console.info("[AudioDBAnalyzer]: Try to start analyzer"),typeof ee>"u"){console.error("[AudioDBAnalyzer]: Meyda could not be found! Have you included it?");return}try{this.store=new te(this.analysisConfig),await this.mic.activateInputDevice(i==null?void 0:i.deviceId),console.log("MIC",this.mic),console.info(`[AudioDBAnalyzer]: Sample Rate ${this.mic.sampleRate}`),console.info(`[AudioDBAnalyzer]: Buffer Size ${this.mic.bufferSize}`),console.info(`[AudioDBAnalyzer]: Windowing Function ${this.analysisConfig.windowingFunction}`),this.analyzer=ee.createMeydaAnalyzer({audioContext:this.mic.audioContext,source:this.mic.sourceAudioNode,sampleRate:this.mic.sampleRate,bufferSize:this.mic.bufferSize,windowingFunction:this.analysisConfig.windowingFunction,featureExtractors:["amplitudeSpectrum"],callback:u=>{this.store.addData(u.amplitudeSpectrum)}}),this.analyzer.start(),console.info("[AudioDBAnalyzer]: Analyzer started")}catch(u){throw console.error("[AudioDBAnalyzer]: Analyzer start failed",u),new Z("Aufnahme konnte nicht gestartet werden. Bitte versuchen Sie es erneut.",u)}}async stopAnalyzer(){if(console.info("[AudioDBAnalyzer]: Try to stop analyzer"),!this.analyzer){console.warn("[AudioDBAnalyzer]: No analyzer to stop found");return}try{this.analyzer.stop(),await this.mic.deactivateInputDevices(),console.info("[AudioDBAnalyzer]: ANALYZER STOP")}catch(i){throw console.error("[AudioDBAnalyzer]: Analyzer stop failed",i),new Z("Aufnahme konnte nicht gestoppt werden. Bitte versuchen Sie es erneut.",i)}}async analyze(i=0,u=void 0){await this.startAnalyzer(u);const h=i||this.analysisConfig.durationSeconds;return this.analysisConfig.durationSeconds=h,await new Promise(y=>{setTimeout(async()=>{await this.stopAnalyzer(),y()},h*1e3)}),this.store}}const re={_calcAWeighting(s){const i=Math.pow(s,2),u=148693636,h=423.9481,g=11577.76,y=544348.84,v=u*Math.pow(i,2),C=+(i+u).toFixed(8)*+(i+h).toFixed(8)*+Math.sqrt(i+g).toFixed(8)*+Math.sqrt(i+y).toFixed(8),E=+(v/C).toFixed(8),z=20*Math.log10(E)+2;return Number(z.toFixed(1))},calcAWeightings(s,i=-80){return s.map(u=>{const h=this._calcAWeighting(u);return h>i?h:i})},calcDBAUsingWeighting(s,i){const u=s+i;return Number(u.toFixed(4))},convertDBSpectrumToDBAsSpectrum(s,i){const u=[];for(const[h,g]of s.entries())u.push(this.calcDBAUsingWeighting(g,i[h]));return u}},ne=2e-5,k={magnitudeToDB(s){if(s<2e-9)return-80;const i=Number((20*Math.log10(s/ne)).toFixed(4));return i===0?0:i},dbToPowerRatio(s){return Number(Math.pow(10,s/10).toFixed(4))},powerRatioToDB(s){return s<1e-4?-80:Number((10*Math.log10(s)).toFixed(4))},dbToMagnitude(s){return s<-45?2e-9:Number(Math.sqrt(this.dbToPowerRatio(s)*Math.pow(ne,2)).toFixed(9))},_getMeasurementDurationInMs(s,i){return Number((i/s*1e3).toFixed(0))},removeFirstMeasurementsByDuration(s,i,u,h=1500){const g=this._getMeasurementDurationInMs(i,u),y=Number((h/g).toFixed(0));return s.slice(y)}},P={_calcRMS(s){const i=s.reduce((u,h)=>u+Math.pow(h,2),0);return Math.sqrt(i/s.length)},magnitudeSpectrumToDBSpectrum(s){return s.map(i=>k.magnitudeToDB(i))},dbSpectrumToDB(s){const i=s.map(h=>k.dbToMagnitude(h)),u=this._calcRMS(i);return k.magnitudeToDB(u)},averageSPL(s){const i=s.reduce((h,g)=>h+k.dbToPowerRatio(g),0),u=s.length;return k.powerRatioToDB(i/u)},totalSPL(s){const i=s.reduce((u,h)=>u+k.dbToPowerRatio(h),0);return k.powerRatioToDB(i)}},qe={_calcDBList(s){return s.map(i=>P.dbSpectrumToDB(i))},_calcDBAList(s,i,u){const h=ie.frequenciesUsingSampleRateBufferSize(i,u),g=re.calcAWeightings(h);return s.map(v=>re.convertDBSpectrumToDBAsSpectrum(v,g)).map(v=>P.dbSpectrumToDB(v))},getResult(s,i,u){console.log("Spectrum List",s);const g=k.removeFirstMeasurementsByDuration(s,i,u).map(T=>P.magnitudeSpectrumToDBSpectrum(T));console.log(g);const y=this._calcDBList(g).filter(T=>T>=0),v=Number(P.averageSPL(y).toFixed(2)),C=Number(Math.min(...y).toFixed(2)),E=Number(Math.max(...y).toFixed(2)),z=this._calcDBAList(g,i,u).filter(T=>T>=0),L=Number(P.averageSPL(z).toFixed(2)),W=Number(Math.min(...z).toFixed(2)),M=Number(Math.max(...z).toFixed(2));return{dbas:z,minDBA:W,maxDBA:M,averageDBA:L,dbs:y,minDB:C,maxDB:E,averageDB:v}}},Ae=["disabled"],Me={key:0,class:"circle animation"},Be={key:1,class:"circle animation"},Fe={key:2,class:"circle animation"},xe={key:3,class:"circle animation"},De={key:4,class:"circle animation"},ze={class:"circle main"},Te={class:"info"},Ce=ge({__name:"ButtonSoundAnimation",props:{info:{default:"Recording..."},busy:{type:Boolean,default:!1}},setup(s){return(i,u)=>(O(),N("button",ye({class:["busy-record",i.busy?"busy":""]},i.$attrs,{disabled:i.busy}),[i.busy?(O(),N("span",Me)):j("",!0),i.busy?(O(),N("span",Be)):j("",!0),i.busy?(O(),N("span",Fe)):j("",!0),i.busy?(O(),N("span",xe)):j("",!0),i.busy?(O(),N("span",De)):j("",!0),J("span",ze,[J("span",Te,we(i.info),1)])],16,Ae))}}),Ie=Se(Ce,[["__scopeId","data-v-5cf0f0ed"]]);export{qe as A,Ie as B,ke as M};
