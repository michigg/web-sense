import{B as w,M as D,A as S}from"./ButtonSoundAnimation-C5I7SYOq.js";import{d as b,r as o,I as f,o as _,e as h,f as l,u as k,M as C,R as I,_ as z}from"./index-D0pVmQRR.js";import{T as F}from"./TaskStepInstructionList-CkM_pn0a.js";const R={class:"noise-measurement-activity"},p="Lärmaufnahme starten",T=b({__name:"ActivityNoiseMeasurement",props:{taskStep:{},sensors:{}},emits:["submit"],setup(y,{emit:v}){const d=y,g=v,i=o(!1),n=o(!1),r=o(p),m=d.sensors.get(f.GEOLOCATION),c=o();m.getPermission();const t=d.sensors.get(f.MIC);t.getPermission();const M=async()=>{i.value=!0,n.value=!1,c.value=void 0,r.value="Lärm wird aufgenommen...";try{const s=new D(t);console.info("micAnalyzer created");const A=await s.analyze(10);console.info("analysisData retrieved");const u=await m.getLocation();console.info("location retrieved");const e=new I;e.addMeta("sampleRate",t.sampleRate),e.addMeta("bufferSize",t.bufferSize),e.addMeta("windowingFunction",s.analysisConfig.windowingFunction),e.addMeta("lowestPerceptibleFrequency",s.analysisConfig.lowestPerceptibleFrequency),e.addMeta("highestPerceptibleFrequency",s.analysisConfig.highestPerceptibleFrequency),console.info("write metadata"),e.addMeasurement("latitude",u.coords.latitude),e.addMeasurement("longitude",u.coords.longitude),e.addMeasurement("accuracy",Number(u.coords.accuracy.toFixed(2)));const a=S.getResult(A.getAmplitudeSpectrumList(),t.sampleRate,t.bufferSize);console.info("write results",a),e.addMeasurement("minDBA",a.minDBA),e.addMeasurement("maxDBA",a.maxDBA),e.addMeasurement("averageDBA",a.averageDBA),e.addMeasurement("minDB",a.minDB),e.addMeasurement("maxDB",a.maxDB),e.addMeasurement("averageDB",a.averageDB),console.info("write log"),n.value=!0,g("submit",[e])}catch(s){console.error(s),c.value=s,n.value=!1}finally{i.value=!1,r.value=p}};return(s,B)=>(_(),h("div",R,[l(F,{title:s.taskStep.title,description:s.taskStep.description,instructions:s.taskStep.instructions},null,8,["title","description","instructions"]),l(k(C),{error:c.value},null,8,["error"]),l(w,{busy:i.value,success:n.value,info:r.value,onClick:M},null,8,["busy","success","info"])]))}}),N=z(T,[["__scopeId","data-v-e202ce97"]]);export{N as default};
